# MCP调用追踪系统 使用说明

## 📋 概述

MCP调用追踪系统自动记录frontend_dev_assistant MCP工具的所有调用，提供**真实的使用统计和性能分析**。

## ✨ 主要特性

### 🔄 自动追踪
- **透明化记录**：无需手动调用，自动记录所有MCP工具使用
- **详细数据**：执行时间、成功率、参数使用、错误信息
- **零干扰**：不影响MCP工具正常使用，失败时静默处理

### 📊 实用统计
- **基础指标**：调用次数、成功率、平均执行时间
- **工具排行**：最常用的MCP工具Top10
- **时间分析**：使用高峰时段、每日调用分布
- **性能监控**：慢调用识别、性能瓶颈分析
- **错误诊断**：失败模式分析、常见错误统计

### 💾 数据导出
- **CSV格式**：可用Excel打开，适合进一步分析
- **JSON格式**：完整数据结构，适合程序处理
- **时间过滤**：支持不同时间范围的数据导出

## 🚀 快速开始

### 1. 查看实时统计
```bash
# 查看最近7天的MCP调用统计
python mcp_stats.py

# 查看最近30天的统计
python mcp_stats.py --days 30

# 查看今天的统计
python mcp_stats.py --days 1
```

### 2. 导出数据
```bash
# 导出为CSV文件（Excel可打开）
python mcp_stats.py --export csv

# 导出为JSON文件（完整数据）
python mcp_stats.py --export json
```

## 📈 统计内容解读

### 基础统计
```
📊 基础统计
总调用次数:              6 次     # MCP工具总使用次数
成功调用:                5 次     # 成功执行的调用
失败调用:                1 次     # 失败的调用
成功率:               83.3%       # 成功率百分比
平均执行时间:        736.7 ms     # 单次调用平均耗时
总结果大小:         21.0KB       # 累计返回数据大小
日均调用:              0.9 次     # 每日平均调用次数
```

### 工具使用排行
```
🛠️ 工具使用排行
 1. get_prompt_template          2 次 ( 33.3%)  135.0ms
 2. generate_vue_component       2 次 ( 33.3%) 1650.0ms
 3. find_reusable_components     1 次 ( 16.7%)  800.0ms
```
显示：排名、工具名、使用次数、占比、平均执行时间

### 使用模式分析
```
⏰ 使用模式
使用高峰时段:           17点 (6次)

📅 每日调用分布:
  2025-06-13:   6 次 ███
```
帮助了解：
- 开发者最活跃的时间段
- 每日使用频率变化
- 工作模式识别

### 错误分析
```
❌ 错误分析
  • generate_vue_component: Vue2 template generation failed (1次)
```
识别：
- 常见错误模式
- 问题工具识别
- 失败原因统计

### 性能分析
```
⚡ 性能分析
慢调用 (>1s):             2 次
  • generate_vue_component: 平均 1650.0ms (2次)
```
监控：
- 性能瓶颈工具
- 响应时间分布
- 优化改进建议

## 🔧 技术实现

### 自动追踪机制
1. **服务器集成**：在MCP服务器中添加调用拦截器
2. **异步记录**：使用异步任务记录，不阻塞工具执行
3. **数据持久化**：JSON格式存储，支持增量更新
4. **错误隔离**：追踪失败不影响MCP工具正常使用

### 数据存储位置
追踪数据保存在以下位置之一：
```
src/data/mcp_calls.json                    # 开发模式
~/.frontend-dev-assistant/mcp_calls.json   # 用户模式
```

### 数据结构
```json
{
  "metadata": {
    "created_at": "2025-06-13T17:02:11.081284",
    "version": "1.0.0",
    "tracker_type": "automatic_mcp_calls"
  },
  "calls": [
    {
      "id": "1734087731081_get_prompt_template",
      "tool_name": "get_prompt_template",
      "timestamp": "2025-06-13T17:02:11.081697",
      "date": "2025-06-13",
      "hour": 17,
      "arguments": {"prompt_type": "git_commit"},
      "execution_time_ms": 150.0,
      "success": true,
      "error_message": null,
      "result_size_bytes": 1024,
      "user_agent": "cursor-mcp"
    }
  ],
  "daily_stats": {
    "2025-06-13": {
      "total_calls": 6,
      "successful_calls": 5,
      "failed_calls": 1,
      "avg_execution_time_ms": 736.67,
      "tool_breakdown": {"get_prompt_template": 2},
      "hourly_distribution": {"17": 6}
    }
  }
}
```

## 💡 使用建议

### 日常监控
1. **每周查看**：`python mcp_stats.py` 了解使用情况
2. **关注成功率**：低于90%需要关注错误原因
3. **性能监控**：关注慢调用，优化使用方式

### 效率分析
1. **工具使用模式**：识别最常用和最少用的工具
2. **时间分布**：了解开发习惯和工作模式
3. **错误模式**：发现工具使用中的常见问题

### 数据导出场景
- **给领导汇报**：导出CSV文件，制作使用报告
- **开发团队分析**：了解团队MCP工具使用情况
- **工具优化**：基于使用数据优化工具功能

## 📊 实际应用场景

### 个人开发者
- 了解自己最常用的AI辅助工具
- 优化开发流程和工具选择
- 监控工具使用效率

### 开发团队
- 统计团队AI工具采用率
- 识别培训需求（低使用率工具）
- 分析开发效率提升效果

### 技术管理
- 评估AI工具投资回报
- 制定工具优化策略
- 监控开发效率指标

## ❓ 常见问题

**Q: 如何知道追踪是否正常工作？**
A: 使用任何MCP工具后，运行 `python mcp_stats.py` 应该能看到调用记录。

**Q: 追踪会影响MCP工具性能吗？**
A: 不会。追踪使用异步记录，对工具执行时间影响微乎其微（<1ms）。

**Q: 数据文件会无限增长吗？**
A: 不会。系统自动限制最多保留1000条调用记录，超出时删除最旧的记录。

**Q: 可以关闭追踪吗？**
A: 可以。修改 `src/frontend_dev_assistant/server.py`，移除调用追踪相关代码即可。

**Q: 支持多用户吗？**
A: 目前按用户目录隔离数据，同一台机器的不同用户有独立的追踪数据。

## 🔄 系统优势

相比之前的模拟数据系统，MCP调用追踪系统的优势：

✅ **真实数据**：记录实际的MCP工具使用情况  
✅ **自动化**：无需手动操作，完全透明  
✅ **轻量级**：对系统性能影响极小  
✅ **实用性**：聚焦真正有用的统计维度  
✅ **可操作**：基于数据可以做出具体优化决策  

---

*最后更新: 2025-06-13* 